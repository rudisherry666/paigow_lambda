// Generic utilities

// Source: http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/
// This is the same as the default java string hash mechanism.
function hashCode(s) {
  var hash = 0, i, chr, len;
  if (s.length === 0) return hash;
  for (i = 0, len = s.length; i < len; i++) {
    chr   = s.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0; // Convert to 32bit integer
  }
  return hash;
}

function newRandomID() {
    // Random number in base-36, uses numbers and all lower-case letters.
    var num1 = Math.random().toString(36),
        num2 = Math.random().toString(36),
        str = "" + num1 + num2;

    // Get rid of all but the letters.
    return str.replace(/[^a-z]+/g, '');
}

  function sum(prev, cur, index, array) {
      return prev + cur;
  }
  function compareArraysBySum(h1, h2) {
      var s1 = h1.reduce(sum),
          s2 = h2.reduce(sum);

      // Add up all the indexes, sort by that.
      if (s1 > s2)
          return 1;
      if (s1 < s2)
          return -1;

      // The sum of the indexes are the same.  Remove the last tile and
      // sort by the sum again.
      if (h1.length > 1)
          return compareArraysBySum(h1.slice(0, h1.length-1), h2.slice(0, h2.length-1));

      // We have only one tile left and it's the same: the two hands are
      // identical so it doesn't matter which one.  Return equal.
      return 0;
  }

module.exports = {
    hashCode: hashCode,
    newRandomID: newRandomID,
    compareArraysBySum: compareArraysBySum
};

